(function(g,o,m,t,f,E){"use strict";const e={};let c=null,d=null;var L={onLoad:function(){o.logger.info("Local Message Editor plugin loaded");try{const i=t.findByProps("MessageContent")?.MessageContent??t.findByName("MessageContent");i&&(c=f.before("render",i.prototype,function(l){const r=this.props?.message;r?.id&&e[r.id]&&(this.props={...this.props,message:{...r,content:e[r.id]}})}));const{getByProps:M}=t.findByProps("openContextMenuLazy","closeContextMenu"),p=M??t.findByProps("openContextMenuLazy");p&&(d=f.before("openContextMenuLazy",p,function(l){const[r,b]=l;l[1]=function(u){const s=b(u),n=u?.message;if(n&&n.author?.id!==u.currentUserId){const C={id:"edit-locally",label:e[n.id]?"Edit Local Copy":"Edit Locally",icon:t.findByName("PencilIcon"),action:function(){const a=e[n.id]||n.content;E.showInputAlert({title:"Edit Message Locally",placeholder:"Enter new message content...",initialValue:a,confirmText:"Save",onConfirm:function(h){h.trim()===""?(delete e[n.id],o.logger.info(`Removed local edit for message ${n.id}`)):(e[n.id]=h,o.logger.info(`Locally edited message ${n.id}`));try{m.ReactNative.InteractionManager?.runAfterInteractions?.(function(){})}catch{o.logger.info("Edit saved, may need to scroll to see changes")}}})}},y=e[n.id]?{id:"remove-local-edit",label:"Remove Local Edit",icon:t.findByName("TrashIcon"),destructive:!0,action:function(){delete e[n.id],o.logger.info(`Removed local edit for message ${n.id}`)}}:null;if(s?.props?.children){const a=Array.isArray(s.props.children)?s.props.children:[s.props.children];a.push(C),y&&a.push(y),s.props.children=a}}return s}})),global.showLocalEdits=function(){const l=Object.keys(e).length;return o.logger.info(`Currently have ${l} local message edits`),console.log(e),e},global.clearAllEdits=function(){Object.keys(e).forEach(function(l){return delete e[l]}),o.logger.info("Cleared all local message edits")},o.logger.info("Local message editor loaded successfully!"),o.logger.info("Long-press any message to see edit options")}catch(i){o.logger.error("Failed to setup message editor:",i)}},onUnload:function(){o.logger.info("Local Message Editor plugin unloaded"),c&&(c(),c=null),d&&(d(),d=null),delete global.showLocalEdits,delete global.clearAllEdits,Object.keys(e).forEach(function(i){return delete e[i]}),o.logger.info("Message edits cleared and patches removed")}};return g.default=L,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta,vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.ui.alerts);
